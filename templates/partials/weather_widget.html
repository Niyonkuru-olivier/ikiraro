{% set weather_data = weather or {} %}
{% set variant = variant if variant is defined else 'compact' %}
{% set theme = theme if theme is defined else 'dark' %}
{% set refresh_seconds = refresh_seconds if refresh_seconds is defined else 300 %}
{% set current = weather_data.get('current', {}) if weather_data else {} %}
{% set districts = weather_data.get('districts', []) if weather_data else [] %}
{% set districts_error = weather_data.get('districts_error') if weather_data else None %}

<div class="weather-marquee-widget{% if theme == 'light' %} weather-marquee-widget--light{% endif %}"
     data-weather-widget
     data-variant="{{ variant }}"
     data-refresh-seconds="{{ refresh_seconds }}">
  <script type="application/json" data-weather-initial>{{ weather_data|tojson }}</script>
  
  <div class="weather-marquee__error" data-weather-error {% if not weather_data.error %}hidden{% endif %}>
    <p>{{ weather_data.error or "Weather unavailable" }}</p>
    <button type="button" class="weather-marquee__retry" data-weather-retry>Retry</button>
  </div>
  
  <div class="weather-marquee__body" data-weather-body {% if weather_data.error %}hidden{% endif %}>
    <div class="weather-marquee__header">
      <span class="weather-marquee__label">ðŸŒ¤ Rwanda Weather</span>
      <span class="weather-marquee__live">LIVE</span>
    </div>
    
    <div class="weather-marquee__track-wrapper" data-weather-districts>
      {% if districts %}
        <div class="weather-marquee__track" data-weather-districts-track>
          {% for district in districts %}
            <div class="weather-marquee__card">
              <span class="weather-marquee__district">{{ district.name }}</span>
              <span class="weather-marquee__temp">
                {% if district.temp_c is not none %}
                  {{ district.temp_c|round|int }}Â°C
                {% else %}
                  â€”
                {% endif %}
              </span>
              {% if district.condition %}
                <span class="weather-marquee__condition">{{ district.condition }}</span>
              {% endif %}
            </div>
          {% endfor %}
          {# Duplicate for seamless marquee loop #}
          {% for district in districts %}
            <div class="weather-marquee__card weather-marquee__card--clone">
              <span class="weather-marquee__district">{{ district.name }}</span>
              <span class="weather-marquee__temp">
                {% if district.temp_c is not none %}
                  {{ district.temp_c|round|int }}Â°C
                {% else %}
                  â€”
                {% endif %}
              </span>
              {% if district.condition %}
                <span class="weather-marquee__condition">{{ district.condition }}</span>
              {% endif %}
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="weather-marquee__empty">
          {{ districts_error or "Loading weather data..." }}
        </p>
      {% endif %}
    </div>
  </div>
</div>
